name: Release

on:
  push:
    tags:
      - 'v*' # Trigger on tags starting with 'v' (e.g., v1.0.0)

jobs:
  build-and-release:
    runs-on: ubuntu-latest # Or other desired platform like windows-latest, macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable # Or specify a specific version like '1.70.0'

      - name: Build release binary
        run: cargo build --release

      - name: Create archive
        shell: bash
        run: |
          # Replace 'plank-time-trials' with the actual name of your executable
          BINARY_NAME="plank-time-trials" 
          TARGET_DIR="target/release"
          ARCHIVE_NAME="${BINARY_NAME}-${{ github.ref_name }}-${{ runner.os }}-${{ runner.arch }}"

          mkdir -p release_artifacts
          cp "${TARGET_DIR}/${BINARY_NAME}" "release_artifacts/"
          # Add any other necessary files here, e.g., README.md, LICENSE
          # cp README.md release_artifacts/

          tar -czvf "${ARCHIVE_NAME}.tar.gz" -C release_artifacts .

      - name: Upload Release Asset
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: |
            *.tar.gz # Upload the created tar.gz file
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}